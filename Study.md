# DB Sharding 개념 정리

## DB Sharding이란?

수평 파티션을 의미하여, 동일한 데이터베이스를 여러개로 쪼갠것이다.

## 샤딩의 장점과 단점

### 장점

- DB 쿼리는 결국 데이터의 개수가 많아지게 되면 굉장히 오래걸리나, 샤딩을 하면 샤드의 개수만큼 1/n 로 속도가 빨라진다.

### 단점

- 서버 운영 난이도와 복잡도가 굉장히 높아져, 가능하면 샤딩을 피하는 것이 최우선되어야 한다.
- 분리 된 샤드간 쿼리 (Cross-Partition Query) 가 발생할 경우, 오히려 단일 데이터 베이스보다 속도가 느려질 수있으며, 트랜잭션을 보장하기가 굉장히 까다로워진다.


### 샤딩 이외의 다른 방법

- 캐싱
- DB Replication (master, slave DB)
- 수직 분할 (Vertically Partition)
- Hot, Warm, Cold 분할

## 샤딩의 종류
- Hash Sharding : 해시를 사용하여 균일하게 DB를 분할
  - 장점 : 간단하게 샤딩구현, 안정적으로 데이터를 균일하게 나눌 수가 있음
  - 단점 : Node 개수가 늘어나면 해시 룰이 전부 어긋나며, 처음부터 샤딩을 다시해야한다. (한 번 샤드 개수를 정하면 어지간하면 고정해야함.)
    - 특정 샤드에만 굉장히 큰 크기의 데이터가 계속 들어가면 해당 샤드만 굉장히 비효율적임
- Dynamic Sharding : Locator Service라고 하는 중개자를 사용해서 샤드키를 관리
  - 장점 : 확장에 유연하며, 중개자에 Shard Key를 계속 추가할 수 있다.
  - 단점 : 로케이터에 의존하기 때문에, 로케이터를 재배치하거나 캐싱할 때, 데이터를 찾지 못하는 오류가 발생한다.
- Entity Group : 같은 파티션 내에서 관련있는 Entity를 저장하는 방식
  - 장점 : 동일한 파티션 내에서의 쿼리는 굉장히 효율적으로 처리가 가능하다.
  - 단점 : cross-partition 쿼리가 많아지면 굉장히 비효율적이다.

## 구현

실제 예제 구현은 위의 Hash Sharding 과 Dynamic Sharding 두가지 방법을 각각 구현하여, 적절한 상황에서 적절하게 사용할 것이다.




